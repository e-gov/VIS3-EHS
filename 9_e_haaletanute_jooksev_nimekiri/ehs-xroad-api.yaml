openapi: 3.0.1
info:
  title: E-hääletanute jooksev nimekiri
  description: EHS poolt VIS3-le osutatava X-tee teenuse spetsifikatsioon
  license:
    name: MIT
  version: 1.0.0
servers:
  - url: https://host/xroad/v1
tags:
  - name: ELECTION
    description: Valimissündmuste info pärimise teenused

paths:
  /elections:
    get:
      summary: Valimissündmuste loetelu
      description: Otspunkt väljastab aktiivsete valimissündmuste loetelu. Aktiivne valimissündmus teenuse kontekstis on selline, mille kohta EHS on valmis väljastama jooksvat e-hääletanute nimekirja.
      responses:
        200:
          description: Edukas operatsioon
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Elections"
        400:
          description: Vigane päring
        500:
          description: Tehniline viga

  /elections/{electionid}/lastseqno:
    get:
      summary: Valimissündmuses viimase e-hääletanu järjenumbri pärimine. 
      description: Valimissündmuses viimase e-hääletanu järjenumbri pärimine.
      parameters:
        - name: electionid
          in: path
          description: Valimissündmuse ID
          required: true
          schema:
            type: string
      responses:
        200:
          description: Edukas operatsioon
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LastSeqNoResponse"
        400:
          description: Vigane päring
        404:
          description: Objekti ei leitud
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
            text/plain:
              schema:
                $ref: "#/components/schemas/GenericError"
        500:
          description: "Tehniline viga" - üldnimetus olukordadele, kus EHS ei suuda päringut teenindada.

  /elections/{electionid}/evotersbatchfrom/{fromseqno}:
    get:
      summary: e-hääletanute pakk
      description: VIS3 pärib EHS-le valimissündmuses e-hääletanute paki, alates järjenumbrist.
      parameters:
        - name: electionid
          in: path
          description: Valimissündmuse ID
          required: true
          schema:
            type: string
        - name: fromseqno
          in: path
          description: Viimase e-hääletanud järjenumber
          required: true
          schema:
            type: number
      responses:
        200:
          description: Edukas operatsioon
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EVotersBatchResponse"
        400:
          description: Vigane päring
        404:
          description: Päritud järjenumbriga e-hääletanut ei ole.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
            text/plain:
              schema:
                $ref: "#/components/schemas/GenericError"
        500:
          description: "Tehniline viga" - üldnimetus olukordadele, kus EHS ei suuda päringut teenindada.

components:
  schemas:

    Elections:
      type: object
      properties:
        elections:
          type: array
          items:
            $ref: "#/components/schemas/Election"

    Election:
      type: object
      description: Valimissündmus
      properties:
        name:
          type: string
          description: Valimissündmuse nimi
          example: "RK_2023"

    LastSeqNoResponse:
      type: object
      properties:
        electionname:
          type: string
          description: Valimissündmuse identifikaator
          example: "RK_2023"
        lastseqno:
          type: number
          description: Viimase e-hääletanu järjenumber; või 0, kui e-hääletanuid veel ei ole.
          example: 54001

    EVotersBatchResponse:
      type: object
      properties:
        electionname:
          type: string
          description: Valimissündmuse identifikaator
          example: "RK_2023"
        fromseqno:
          type: number
          description: E-hääletanu järjenumber, millest alates on pakis kirjed
          example: 54001
        batchmaxsize:
          type: number
          description: Maksimaalne kirjete arv pakis.
          example: 100
        evotersbatch:
          type: object
          properties:
            batchrecords:
              type: array
                items:
                  $ref: "#/components/schemas/EVoter"

    EVoter:
      type: object
      properties:
        idcode:
          type: string
          description: Isikukood
          example: "38101010020"
        votername:
          type: string
          description: E-hääletanu nimi (nii ees- kui perekonnanimi), teabeliseks otstarbeks.
          example: "LEO KASS"
        seqno:
          type: number
          description: E-hääletanu järjenumber (konkreetses valimissündmuses)
          example: 54001
        kovcode:
          type: string
          description: KOV EHAK kood
          example: "0068"
        electoraldisctrictid:
          type: number
          description: Valimisringkonna number
          example: 4

    ErrorResponse:
      type: array
      description: Päringu töötlemise ebaõnnestumise korral tagastatav veasõnum
      items:
        type: object
        properties:
          code:
            type: string
            description: Vea kood
            example: "not_found"
          field:
            type: string
            description: Viide vea põhjustanud atribuudile
            example: "id"
          value:
            type: integer
            description: Vea kood
            example: 0

    GenericError:
      type: string
      description: Ei leidu
      example: "404 Not Found"
